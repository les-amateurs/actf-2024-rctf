"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", { value: true });
const path_1 = __importDefault(require("path"));
const fs_1 = __importDefault(require("fs"));
const yaml_1 = __importDefault(require("yaml"));
const deepmerge_1 = __importDefault(require("deepmerge"));
const util_1 = require("./util");
const jsonLoader = (file) => JSON.parse(file);
const yamlLoader = (file) => yaml_1.default.parse(file);
const fileConfigLoaders = new Map([
    ['json', jsonLoader],
    ['yaml', yamlLoader],
    ['yml', yamlLoader]
]);
const configPath = (_a = process.env.RCTF_CONF_PATH) !== null && _a !== void 0 ? _a : path_1.default.join(__dirname, '../../../conf.d');
const fileConfigs = [];
fs_1.default.readdirSync(configPath).sort().forEach((name) => {
    const matched = /\.(.+)$/.exec(name);
    if (matched === null) {
        return;
    }
    const loader = fileConfigLoaders.get(matched[1]);
    if (loader === undefined) {
        return;
    }
    const config = loader(fs_1.default.readFileSync(path_1.default.join(configPath, name)).toString());
    fileConfigs.push(config);
});
const envConfig = {
    database: {
        sql: (_b = process.env.RCTF_DATABASE_URL) !== null && _b !== void 0 ? _b : {
            host: process.env.RCTF_DATABASE_HOST,
            port: util_1.nullsafeParseInt(process.env.RCTF_DATABASE_PORT),
            user: process.env.RCTF_DATABASE_USERNAME,
            password: process.env.RCTF_DATABASE_PASSWORD,
            database: process.env.RCTF_DATABASE_DATABASE
        },
        redis: (_c = process.env.RCTF_REDIS_URL) !== null && _c !== void 0 ? _c : {
            host: process.env.RCTF_REDIS_HOST,
            port: util_1.nullsafeParseInt(process.env.RCTF_REDIS_PORT),
            password: process.env.RCTF_REDIS_PASSWORD,
            database: util_1.nullsafeParseInt(process.env.RCTF_REDIS_DATABASE)
        },
        migrate: process.env.RCTF_DATABASE_MIGRATE
    },
    instanceType: process.env.RCTF_INSTANCE_TYPE,
    tokenKey: process.env.RCTF_TOKEN_KEY,
    origin: process.env.RCTF_ORIGIN,
    ctftime: {
        clientId: process.env.RCTF_CTFTIME_CLIENT_ID,
        clientSecret: process.env.RCTF_CTFTIME_CLIENT_SECRET
    },
    userMembers: util_1.nullsafeParseBoolEnv(process.env.RCTF_USER_MEMBERS),
    homeContent: process.env.RCTF_HOME_CONTENT,
    ctfName: process.env.RCTF_NAME,
    meta: {
        description: process.env.RCTF_META_DESCRIPTION,
        imageUrl: process.env.RCTF_IMAGE_URL
    },
    faviconUrl: process.env.RCTF_FAVICON_URL,
    logoUrl: process.env.RCTF_LOGO_URL,
    globalSiteTag: process.env.RCTF_GLOBAL_SITE_TAG,
    email: {
        from: process.env.RCTF_EMAIL_FROM
    },
    startTime: util_1.nullsafeParseInt(process.env.RCTF_START_TIME),
    endTime: util_1.nullsafeParseInt(process.env.RCTF_END_TIME),
    recaptcha: {
        siteKey: process.env.RCTF_RECAPTCHA_SITE_KEY,
        secretKey: process.env.RCTF_RECAPTCHA_SECRET_KEY
    },
    leaderboard: {
        maxLimit: util_1.nullsafeParseInt(process.env.RCTF_LEADERBOARD_MAX_LIMIT),
        maxOffset: util_1.nullsafeParseInt(process.env.RCTF_LEADERBOARD_MAX_OFFSET),
        updateInterval: util_1.nullsafeParseInt(process.env.RCTF_LEADERBOARD_UPDATE_INTERVAL),
        graphMaxTeams: util_1.nullsafeParseInt(process.env.RCTF_LEADERBOARD_GRAPH_MAX_TEAMS),
        graphSampleTime: util_1.nullsafeParseInt(process.env.RCTF_LEADERBOARD_GRAPH_SAMPLE_TIME)
    },
    loginTimeout: util_1.nullsafeParseInt(process.env.RCTF_LOGIN_TIMEOUT),
    paranoia: {
        apiUrl: process.env.RCTF_PARANOIA_URL
    }
};
const defaultConfig = {
    database: {
        migrate: 'never'
    },
    instanceType: 'all',
    userMembers: true,
    sponsors: [],
    homeContent: '',
    faviconUrl: 'https://redpwn.storage.googleapis.com/branding/rctf-favicon.ico',
    challengeProvider: {
        name: 'challenges/database'
    },
    uploadProvider: {
        name: 'uploads/local'
    },
    storeProvider: {
        name: 'store/database'
    },
    proxy: {
        cloudflare: false,
        trust: false
    },
    meta: {
        description: '',
        imageUrl: ''
    },
    leaderboard: {
        maxLimit: 100,
        maxOffset: 4294967296,
        updateInterval: 10000,
        graphMaxTeams: 10,
        graphSampleTime: 1800000
    },
    loginTimeout: 3600000
};
const config = deepmerge_1.default.all([defaultConfig, ...fileConfigs, util_1.removeUndefined(envConfig)]);
exports.default = config;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VydmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc2VydmVyL2NvbmZpZy9zZXJ2ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsZ0RBQXVCO0FBQ3ZCLDRDQUFtQjtBQUNuQixnREFBdUI7QUFDdkIsMERBQWlDO0FBRWpDLGlDQUFnRjtBQWdHaEYsTUFBTSxVQUFVLEdBQUcsQ0FBQyxJQUFZLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUE4QixDQUFBO0FBQ2xGLE1BQU0sVUFBVSxHQUFHLENBQUMsSUFBWSxFQUFFLEVBQUUsQ0FBQyxjQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBOEIsQ0FBQTtBQUVsRixNQUFNLGlCQUFpQixHQUE2RCxJQUFJLEdBQUcsQ0FBQztJQUMxRixDQUFDLE1BQU0sRUFBRSxVQUFVLENBQUM7SUFDcEIsQ0FBQyxNQUFNLEVBQUUsVUFBVSxDQUFDO0lBQ3BCLENBQUMsS0FBSyxFQUFFLFVBQVUsQ0FBQztDQUNwQixDQUFDLENBQUE7QUFFRixNQUFNLFVBQVUsU0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsbUNBQUksY0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsaUJBQWlCLENBQUMsQ0FBQTtBQUN4RixNQUFNLFdBQVcsR0FBZ0MsRUFBRSxDQUFBO0FBQ25ELFlBQUUsQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7SUFDakQsTUFBTSxPQUFPLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUNwQyxJQUFJLE9BQU8sS0FBSyxJQUFJLEVBQUU7UUFDcEIsT0FBTTtLQUNQO0lBQ0QsTUFBTSxNQUFNLEdBQUcsaUJBQWlCLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBQ2hELElB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QUFFO1FBQ2pCLGVBQWUsRUFBRSxPQUFPO0tBQ3pCO0lBQ0QsWUFBWSxFQUFFLE9BQU87Q0FDdEIsQ0FBQTtBQUVELE1BQU0sTUFBTSxHQUFHLG1CQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsYUFBYSxFQUFFLEdBQUcsV0FBVyxFQUFFLHNCQUFlLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBaUIsQ0FBQTtBQUV6RyxrQkFBZSxNQUFNLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcGF0aCBmcm9tICdwYXRoJ1xuaW1wb3J0IGZzIGZyb20gJ2ZzJ1xuaW1wb3J0IHlhbWwgZnJvbSAneWFtbCdcbmltcG9ydCBkZWVwTWVyZ2UgZnJvbSAnZGVlcG1lcmdlJ1xuaW1wb3J0IHsgUGFydGlhbERlZXAgfSBmcm9tICd0eXBlLWZlc3QnXG5pbXBvcnQgeyBudWxsc2FmZVBhcnNlSW50LCBudWxsc2FmZVBhcnNlQm9vbEVudiwgcmVtb3ZlVW5kZWZpbmVkIH0gZnJvbSAnLi91dGlsJ1xuaW1wb3J0IHsgQUNMIH0gZnJvbSAnLi4vdXRpbC9yZXN0cmljdCdcbmltcG9ydCB7IFJlY2FwdGNoYVByb3RlY3RlZEFjdGlvbnMgfSBmcm9tICcuLi91dGlsL3JlY2FwdGNoYSdcblxuZXhwb3J0IHR5cGUgUHJvdmlkZXJDb25maWcgPSB7XG4gIG5hbWU6IHN0cmluZztcbiAgb3B0aW9uczogdW5rbm93bjtcbn1cblxuZXhwb3J0IHR5cGUgU3BvbnNvciA9IHtcbiAgbmFtZTogc3RyaW5nO1xuICBpY29uOiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIHNtYWxsPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IHR5cGUgU2VydmVyQ29uZmlnID0ge1xuICBkYXRhYmFzZToge1xuICAgIHNxbDogc3RyaW5nIHwge1xuICAgICAgaG9zdDogc3RyaW5nO1xuICAgICAgcG9ydDogbnVtYmVyO1xuICAgICAgdXNlcjogc3RyaW5nO1xuICAgICAgcGFzc3dvcmQ6IHN0cmluZztcbiAgICAgIGRhdGFiYXNlOiBzdHJpbmc7XG4gICAgfVxuICAgIHJlZGlzOiBzdHJpbmcgfCB7XG4gICAgICBob3N0OiBzdHJpbmc7XG4gICAgICBwb3J0OiBudW1iZXI7XG4gICAgICBwYXNzd29yZDogc3RyaW5nO1xuICAgICAgZGF0YWJhc2U6IG51bWJlcjtcbiAgICB9XG4gICAgbWlncmF0ZTogc3RyaW5nO1xuICB9XG4gIGluc3RhbmNlVHlwZTogc3RyaW5nO1xuICB0b2tlbktleTogc3RyaW5nO1xuICBvcmlnaW46IHN0cmluZztcblxuICAvLyBUT0RPOiBlbmZvcmNlIGB0cnVzdGAgaXMgZmFsc2Ugd2hlbiBgY2xvdWRmbGFyZWAgaXMgdHJ1ZVxuICBwcm94eToge1xuICAgIGNsb3VkZmxhcmU6IGJvb2xlYW5cbiAgICB0cnVzdDogYm9vbGVhbiB8IHN0cmluZyB8IHN0cmluZ1tdIHwgbnVtYmVyXG4gIH1cblxuICBjdGZ0aW1lPzoge1xuICAgIGNsaWVudElkOiBzdHJpbmc7XG4gICAgY2xpZW50U2VjcmV0OiBzdHJpbmc7XG4gIH1cblxuICB1c2VyTWVtYmVyczogYm9vbGVhbjtcbiAgc3BvbnNvcnM6IFNwb25zb3JbXTtcbiAgaG9tZUNvbnRlbnQ6IHN0cmluZztcbiAgY3RmTmFtZTogc3RyaW5nO1xuICBtZXRhOiB7XG4gICAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgICBpbWFnZVVybDogc3RyaW5nO1xuICB9XG4gIGZhdmljb25Vcmw/OiBzdHJpbmc7XG4gIGxvZ29Vcmw/OiBzdHJpbmc7XG4gIGdsb2JhbFNpdGVUYWc/OiBzdHJpbmc7XG5cbiAgY2hhbGxlbmdlUHJvdmlkZXI6IFByb3ZpZGVyQ29uZmlnO1xuICB1cGxvYWRQcm92aWRlcjogUHJvdmlkZXJDb25maWc7XG4gIHN0b3JlUHJvdmlkZXI6IFByb3ZpZGVyQ29uZmlnO1xuXG4gIGVtYWlsPzoge1xuICAgIHByb3ZpZGVyOiBQcm92aWRlckNvbmZpZztcbiAgICBmcm9tOiBzdHJpbmc7XG4gIH1cblxuICBkaXZpc2lvbnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG4gIGRlZmF1bHREaXZpc2lvbj86IHN0cmluZztcbiAgZGl2aXNpb25BQ0xzPzogQUNMW107XG5cbiAgc3RhcnRUaW1lOiBudW1iZXI7XG4gIGVuZFRpbWU6IG51bWJlcjtcblxuICByZWNhcHRjaGE/OiB7XG4gICAgc2l0ZUtleTogc3RyaW5nO1xuICAgIHNlY3JldEtleTogc3RyaW5nO1xuICAgIHByb3RlY3RlZEFjdGlvbnM6IFJlY2FwdGNoYVByb3RlY3RlZEFjdGlvbnNbXTtcbiAgfVxuXG4gIGxlYWRlcmJvYXJkOiB7XG4gICAgbWF4TGltaXQ6IG51bWJlcjtcbiAgICBtYXhPZmZzZXQ6IG51bWJlcjtcbiAgICB1cGRhdGVJbnRlcnZhbDogbnVtYmVyO1xuICAgIGdyYXBoTWF4VGVhbXM6IG51bWJlcjtcbiAgICBncmFwaFNhbXBsZVRpbWU6IG51bWJlcjtcbiAgfVxuICBsb2dpblRpbWVvdXQ6IG51bWJlcjtcblxuICBwYXJhbm9pYT86IHtcbiAgICBhcGlVcmw6IHN0cmluZztcbiAgfVxufVxuXG5jb25zdCBqc29uTG9hZGVyID0gKGZpbGU6IHN0cmluZykgPT4gSlNPTi5wYXJzZShmaWxlKSBhcyBQYXJ0aWFsRGVlcDxTZXJ2ZXJDb25maWc+XG5jb25zdCB5YW1sTG9hZGVyID0gKGZpbGU6IHN0cmluZykgPT4geWFtbC5wYXJzZShmaWxlKSBhcyBQYXJ0aWFsRGVlcDxTZXJ2ZXJDb25maWc+XG5cbmNvbnN0IGZpbGVDb25maWdMb2FkZXJzOiBNYXA8c3RyaW5nLCAoZmlsZTogc3RyaW5nKSA9PiBQYXJ0aWFsRGVlcDxTZXJ2ZXJDb25maWc+PiA9IG5ldyBNYXAoW1xuICBbJ2pzb24nLCBqc29uTG9hZGVyXSxcbiAgWyd5YW1sJywgeWFtbExvYWRlcl0sXG4gIFsneW1sJywgeWFtbExvYWRlcl1cbl0pXG5cbmNvbnN0IGNvbmZpZ1BhdGggPSBwcm9jZXNzLmVudi5SQ1RGX0NPTkZfUEFUSCA/PyBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vLi4vLi4vY29uZi5kJylcbmNvbnN0IGZpbGVDb25maWdzOiBQYXJ0aWFsRGVlcDxTZXJ2ZXJDb25maWc+W10gPSBbXVxuZnMucmVhZGRpclN5bmMoY29uZmlnUGF0aCkuc29ydCgpLmZvckVhY2goKG5hbWUpID0+IHtcbiAgY29uc3QgbWF0Y2hlZCA9IC9cXC4oLispJC8uZXhlYyhuYW1lKVxuICBpZiAobWF0Y2hlZCA9PT0gbnVsbCkge1xuICAgIHJldHVyblxuICB9XG4gIGNvbnN0IGxvYWRlciA9IGZpbGVDb25maWdMb2FkZXJzLmdldChtYXRjaGVkWzFdKVxuICBpZiAobG9hZGVyID09PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm5cbiAgfVxuICBjb25zdCBjb25maWcgPSBsb2FkZXIoZnMucmVhZEZpbGVTeW5jKHBhdGguam9pbihjb25maWdQYXRoLCBuYW1lKSkudG9TdHJpbmcoKSlcbiAgZmlsZUNvbmZpZ3MucHVzaChjb25maWcpXG59KVxuXG5jb25zdCBlbnZDb25maWc6IFBhcnRpYWxEZWVwPFNlcnZlckNvbmZpZz4gPSB7XG4gIGRhdGFiYXNlOiB7XG4gICAgc3FsOiBwcm9jZXNzLmVudi5SQ1RGX0RBVEFCQVNFX1VSTCA/PyB7XG4gICAgICBob3N0OiBwcm9jZXNzLmVudi5SQ1RGX0RBVEFCQVNFX0hPU1QsXG4gICAgICBwb3J0OiBudWxsc2FmZVBhcnNlSW50KHByb2Nlc3MuZW52LlJDVEZfREFUQUJBU0VfUE9SVCksXG4gICAgICB1c2VyOiBwcm9jZXNzLmVudi5SQ1RGX0RBVEFCQVNFX1VTRVJOQU1FLFxuICAgICAgcGFzc3dvcmQ6IHByb2Nlc3MuZW52LlJDVEZfREFUQUJBU0VfUEFTU1dPUkQsXG4gICAgICBkYXRhYmFzZTogcHJvY2Vzcy5lbnYuUkNURl9EQVRBQkFTRV9EQVRBQkFTRVxuICAgIH0sXG4gICAgcmVkaXM6IHByb2Nlc3MuZW52LlJDVEZfUkVESVNfVVJMID8/IHtcbiAgICAgIGhvc3Q6IHByb2Nlc3MuZW52LlJDVEZfUkVESVNfSE9TVCxcbiAgICAgIHBvcnQ6IG51bGxzYWZlUGFyc2VJbnQocHJvY2Vzcy5lbnYuUkNURl9SRURJU19QT1JUKSxcbiAgICAgIHBhc3N3b3JkOiBwcm9jZXNzLmVudi5SQ1RGX1JFRElTX1BBU1NXT1JELFxuICAgICAgZGF0YWJhc2U6IG51bGxzYWZlUGFyc2VJbnQocHJvY2Vzcy5lbnYuUkNURl9SRURJU19EQVRBQkFTRSlcbiAgICB9LFxuICAgIG1pZ3JhdGU6IHByb2Nlc3MuZW52LlJDVEZfREFUQUJBU0VfTUlHUkFURVxuICB9LFxuICBpbnN0YW5jZVR5cGU6IHByb2Nlc3MuZW52LlJDVEZfSU5TVEFOQ0VfVFlQRSxcbiAgdG9rZW5LZXk6IHByb2Nlc3MuZW52LlJDVEZfVE9LRU5fS0VZLFxuICBvcmlnaW46IHByb2Nlc3MuZW52LlJDVEZfT1JJR0lOLFxuICBjdGZ0aW1lOiB7XG4gICAgY2xpZW50SWQ6IHByb2Nlc3MuZW52LlJDVEZfQ1RGVElNRV9DTElFTlRfSUQsXG4gICAgY2xpZW50U2VjcmV0OiBwcm9jZXNzLmVudi5SQ1RGX0NURlRJTUVfQ0xJRU5UX1NFQ1JFVFxuICB9LFxuICB1c2VyTWVtYmVyczogbnVsbHNhZmVQYXJzZUJvb2xFbnYocHJvY2Vzcy5lbnYuUkNURl9VU0VSX01FTUJFUlMpLFxuICBob21lQ29udGVudDogcHJvY2Vzcy5lbnYuUkNURl9IT01FX0NPTlRFTlQsXG4gIGN0Zk5hbWU6IHByb2Nlc3MuZW52LlJDVEZfTkFNRSxcbiAgbWV0YToge1xuICAgIGRlc2NyaXB0aW9uOiBwcm9jZXNzLmVudi5SQ1RGX01FVEFfREVTQ1JJUFRJT04sXG4gICAgaW1hZ2VVcmw6IHByb2Nlc3MuZW52LlJDVEZfSU1BR0VfVVJMXG4gIH0sXG4gIGZhdmljb25Vcmw6IHByb2Nlc3MuZW52LlJDVEZfRkFWSUNPTl9VUkwsXG4gIGxvZ29Vcmw6IHByb2Nlc3MuZW52LlJDVEZfTE9HT19VUkwsXG4gIGdsb2JhbFNpdGVUYWc6IHByb2Nlc3MuZW52LlJDVEZfR0xPQkFMX1NJVEVfVEFHLFxuICBlbWFpbDoge1xuICAgIGZyb206IHByb2Nlc3MuZW52LlJDVEZfRU1BSUxfRlJPTVxuICB9LFxuICBzdGFydFRpbWU6IG51bGxzYWZlUGFyc2VJbnQocHJvY2Vzcy5lbnYuUkNURl9TVEFSVF9USU1FKSxcbiAgZW5kVGltZTogbnVsbHNhZmVQYXJzZUludChwcm9jZXNzLmVudi5SQ1RGX0VORF9USU1FKSxcbiAgcmVjYXB0Y2hhOiB7XG4gICAgc2l0ZUtleTogcHJvY2Vzcy5lbnYuUkNURl9SRUNBUFRDSEFfU0lURV9LRVksXG4gICAgc2VjcmV0S2V5OiBwcm9jZXNzLmVudi5SQ1RGX1JFQ0FQVENIQV9TRUNSRVRfS0VZXG4gIH0sXG4gIGxlYWRlcmJvYXJkOiB7XG4gICAgbWF4TGltaXQ6IG51bGxzYWZlUGFyc2VJbnQocHJvY2Vzcy5lbnYuUkNURl9MRUFERVJCT0FSRF9NQVhfTElNSVQpLFxuICAgIG1heE9mZnNldDogbnVsbHNhZmVQYXJzZUludChwcm9jZXNzLmVudi5SQ1RGX0xFQURFUkJPQVJEX01BWF9PRkZTRVQpLFxuICAgIHVwZGF0ZUludGVydmFsOiBudWxsc2FmZVBhcnNlSW50KHByb2Nlc3MuZW52LlJDVEZfTEVBREVSQk9BUkRfVVBEQVRFX0lOVEVSVkFMKSxcbiAgICBncmFwaE1heFRlYW1zOiBudWxsc2FmZVBhcnNlSW50KHByb2Nlc3MuZW52LlJDVEZfTEVBREVSQk9BUkRfR1JBUEhfTUFYX1RFQU1TKSxcbiAgICBncmFwaFNhbXBsZVRpbWU6IG51bGxzYWZlUGFyc2VJbnQocHJvY2Vzcy5lbnYuUkNURl9MRUFERVJCT0FSRF9HUkFQSF9TQU1QTEVfVElNRSlcbiAgfSxcbiAgbG9naW5UaW1lb3V0OiBudWxsc2FmZVBhcnNlSW50KHByb2Nlc3MuZW52LlJDVEZfTE9HSU5fVElNRU9VVCksXG4gIHBhcmFub2lhOiB7XG4gICAgYXBpVXJsOiBwcm9jZXNzLmVudi5SQ1RGX1BBUkFOT0lBX1VSTFxuICB9XG59XG5cbmNvbnN0IGRlZmF1bHRDb25maWc6IFBhcnRpYWxEZWVwPFNlcnZlckNvbmZpZz4gPSB7XG4gIGRhdGFiYXNlOiB7XG4gICAgbWlncmF0ZTogJ25ldmVyJ1xuICB9LFxuICBpbnN0YW5jZVR5cGU6ICdhbGwnLFxuICB1c2VyTWVtYmVyczogdHJ1ZSxcbiAgc3BvbnNvcnM6IFtdLFxuICBob21lQ29udGVudDogJycsXG4gIGZhdmljb25Vcmw6ICdodHRwczovL3JlZHB3bi5zdG9yYWdlLmdvb2dsZWFwaXMuY29tL2JyYW5kaW5nL3JjdGYtZmF2aWNvbi5pY28nLFxuICBjaGFsbGVuZ2VQcm92aWRlcjoge1xuICAgIG5hbWU6ICdjaGFsbGVuZ2VzL2RhdGFiYXNlJ1xuICB9LFxuICB1cGxvYWRQcm92aWRlcjoge1xuICAgIG5hbWU6ICd1cGxvYWRzL2xvY2FsJ1xuICB9LFxuICBzdG9yZVByb3ZpZGVyOiB7XG4gICAgbmFtZTogJ3N0b3JlL2RhdGFiYXNlJ1xuICB9LFxuICBwcm94eToge1xuICAgIGNsb3VkZmxhcmU6IGZhbHNlLFxuICAgIHRydXN0OiBmYWxzZVxuICB9LFxuICBtZXRhOiB7XG4gICAgZGVzY3JpcHRpb246ICcnLFxuICAgIGltYWdlVXJsOiAnJ1xuICB9LFxuICBsZWFkZXJib2FyZDoge1xuICAgIG1heExpbWl0OiAxMDAsXG4gICAgbWF4T2Zmc2V0OiA0Mjk0OTY3Mjk2LFxuICAgIHVwZGF0ZUludGVydmFsOiAxMDAwMCxcbiAgICBncmFwaE1heFRlYW1zOiAxMCxcbiAgICBncmFwaFNhbXBsZVRpbWU6IDE4MDAwMDBcbiAgfSxcbiAgbG9naW5UaW1lb3V0OiAzNjAwMDAwXG59XG5cbmNvbnN0IGNvbmZpZyA9IGRlZXBNZXJnZS5hbGwoW2RlZmF1bHRDb25maWcsIC4uLmZpbGVDb25maWdzLCByZW1vdmVVbmRlZmluZWQoZW52Q29uZmlnKV0pIGFzIFNlcnZlckNvbmZpZ1xuXG5leHBvcnQgZGVmYXVsdCBjb25maWdcbiJdfQ==