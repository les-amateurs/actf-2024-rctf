"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.removeSolvesByUserId = exports.newSolve = exports.getSolveByUserIdAndChallId = exports.getSolvesByChallId = exports.getSolvesByUserId = exports.getAllSolves = void 0;
const db_1 = __importDefault(require("./db"));
exports.getAllSolves = () => {
    return db_1.default.query('SELECT * FROM solves ORDER BY createdat ASC')
        .then(res => res.rows);
};
exports.getSolvesByUserId = ({ userid }) => {
    return db_1.default.query('SELECT * FROM solves WHERE userid = $1 ORDER BY createdat DESC', [userid])
        .then(res => res.rows);
};
exports.getSolvesByChallId = ({ challengeid, limit, offset }) => {
    return db_1.default.query('SELECT solves.id, solves.userid, solves.createdat, users.name FROM solves INNER JOIN users ON solves.userid = users.id WHERE solves.challengeid=$1 ORDER BY solves.createdat ASC LIMIT $2 OFFSET $3', [challengeid, limit, offset])
        .then(res => res.rows);
};
exports.getSolveByUserIdAndChallId = ({ userid, challengeid }) => {
    return db_1.default.query('SELECT * FROM solves WHERE userid = $1 AND challengeid = $2 ORDER BY createdat DESC', [userid, challengeid])
        .then(res => res.rows[0]);
};
exports.newSolve = ({ id, userid, challengeid, createdat }) => {
    return db_1.default.query('INSERT INTO solves (id, challengeid, userid, createdat) VALUES ($1, $2, $3, $4) RETURNING *', [id, challengeid, userid, createdat])
        .then(res => res.rows[0]);
};
exports.removeSolvesByUserId = async ({ userid }) => {
    await db_1.default.query('DELETE FROM solves WHERE userid = $1', [userid]);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29sdmVzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc2VydmVyL2RhdGFiYXNlL3NvbHZlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSw4Q0FBcUI7QUFZUixRQUFBLFlBQVksR0FBRyxHQUFxQixFQUFFO0lBQ2pELE9BQU8sWUFBRSxDQUFDLEtBQUssQ0FBUSw2Q0FBNkMsQ0FBQztTQUNsRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUE7QUFDMUIsQ0FBQyxDQUFBO0FBRVksUUFBQSxpQkFBaUIsR0FBRyxDQUFDLEVBQUUsTUFBTSxFQUF5QixFQUFvQixFQUFFO0lBQ3ZGLE9BQU8sWUFBRSxDQUFDLEtBQUssQ0FBUSxnRUFBZ0UsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQy9GLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQTtBQUMxQixDQUFDLENBQUE7QUFFWSxRQUFBLGtCQUFrQixHQUFHLENBQUMsRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBbUUsRUFBMkMsRUFBRTtJQUM3SyxPQUFPLFlBQUUsQ0FBQyxLQUFLLENBQThDLHFNQUFxTSxFQUFFLENBQUMsV0FBVyxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztTQUM5UixJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUE7QUFDMUIsQ0FBQyxDQUFBO0FBRVksUUFBQSwwQkFBMEIsR0FBRyxDQUFDLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBeUMsRUFBOEIsRUFBRTtJQUN2SSxPQUFPLFlBQUUsQ0FBQyxLQUFLLENBQVEscUZBQXFGLEVBQUUsQ0FBQyxNQUFNLEVBQUUsV0FBVyxDQUFDLENBQUM7U0FDakksSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO0FBQzdCLENBQUMsQ0FBQTtBQUVZLFFBQUEsUUFBUSxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQVMsRUFBa0IsRUFBRTtJQUN4RixPQUFPLFlBQUUsQ0FBQyxLQUFLLENBQVEsNkZBQTZGLEVBQUUsQ0FBQyxFQUFFLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxTQUFTLENBQUMsQ0FBQztTQUN4SixJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDN0IsQ0FBQyxDQUFBO0FBRVksUUFBQSxvQkFBb0IsR0FBRyxLQUFLLEVBQUUsRUFBRSxNQUFNLEVBQXlCLEVBQWlCLEVBQUU7SUFDN0YsTUFBTSxZQUFFLENBQUMsS0FBSyxDQUFDLHNDQUFzQyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQTtBQUNsRSxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZGIgZnJvbSAnLi9kYidcbmltcG9ydCB7IENoYWxsZW5nZSB9IGZyb20gJy4uL2NoYWxsZW5nZXMvdHlwZXMnXG5pbXBvcnQgeyBVc2VyIH0gZnJvbSAnLi91c2VycydcbmltcG9ydCB7IEV4dHJhY3RRdWVyeVR5cGUgfSBmcm9tICcuL3V0aWwnXG5cbmV4cG9ydCBpbnRlcmZhY2UgU29sdmUge1xuICBpZDogc3RyaW5nO1xuICBjaGFsbGVuZ2VpZDogQ2hhbGxlbmdlWydpZCddO1xuICB1c2VyaWQ6IFVzZXJbJ2lkJ107XG4gIGNyZWF0ZWRhdDogRGF0ZTtcbn1cblxuZXhwb3J0IGNvbnN0IGdldEFsbFNvbHZlcyA9ICgpOiBQcm9taXNlPFNvbHZlW10+ID0+IHtcbiAgcmV0dXJuIGRiLnF1ZXJ5PFNvbHZlPignU0VMRUNUICogRlJPTSBzb2x2ZXMgT1JERVIgQlkgY3JlYXRlZGF0IEFTQycpXG4gICAgLnRoZW4ocmVzID0+IHJlcy5yb3dzKVxufVxuXG5leHBvcnQgY29uc3QgZ2V0U29sdmVzQnlVc2VySWQgPSAoeyB1c2VyaWQgfTogUGljazxTb2x2ZSwgJ3VzZXJpZCc+KTogUHJvbWlzZTxTb2x2ZVtdPiA9PiB7XG4gIHJldHVybiBkYi5xdWVyeTxTb2x2ZT4oJ1NFTEVDVCAqIEZST00gc29sdmVzIFdIRVJFIHVzZXJpZCA9ICQxIE9SREVSIEJZIGNyZWF0ZWRhdCBERVNDJywgW3VzZXJpZF0pXG4gICAgLnRoZW4ocmVzID0+IHJlcy5yb3dzKVxufVxuXG5leHBvcnQgY29uc3QgZ2V0U29sdmVzQnlDaGFsbElkID0gKHsgY2hhbGxlbmdlaWQsIGxpbWl0LCBvZmZzZXQgfTogUGljazxTb2x2ZSwgJ2NoYWxsZW5nZWlkJz4gJiB7IGxpbWl0OiBudW1iZXI7IG9mZnNldDogbnVtYmVyOyB9KTogUHJvbWlzZTwoU29sdmUgJiBQaWNrPFVzZXIsICduYW1lJz4pW10+ID0+IHtcbiAgcmV0dXJuIGRiLnF1ZXJ5PEV4dHJhY3RRdWVyeVR5cGU8dHlwZW9mIGdldFNvbHZlc0J5Q2hhbGxJZD4+KCdTRUxFQ1Qgc29sdmVzLmlkLCBzb2x2ZXMudXNlcmlkLCBzb2x2ZXMuY3JlYXRlZGF0LCB1c2Vycy5uYW1lIEZST00gc29sdmVzIElOTkVSIEpPSU4gdXNlcnMgT04gc29sdmVzLnVzZXJpZCA9IHVzZXJzLmlkIFdIRVJFIHNvbHZlcy5jaGFsbGVuZ2VpZD0kMSBPUkRFUiBCWSBzb2x2ZXMuY3JlYXRlZGF0IEFTQyBMSU1JVCAkMiBPRkZTRVQgJDMnLCBbY2hhbGxlbmdlaWQsIGxpbWl0LCBvZmZzZXRdKVxuICAgIC50aGVuKHJlcyA9PiByZXMucm93cylcbn1cblxuZXhwb3J0IGNvbnN0IGdldFNvbHZlQnlVc2VySWRBbmRDaGFsbElkID0gKHsgdXNlcmlkLCBjaGFsbGVuZ2VpZCB9OiBQaWNrPFNvbHZlLCAndXNlcmlkJyB8ICdjaGFsbGVuZ2VpZCc+KTogUHJvbWlzZTxTb2x2ZSB8IHVuZGVmaW5lZD4gPT4ge1xuICByZXR1cm4gZGIucXVlcnk8U29sdmU+KCdTRUxFQ1QgKiBGUk9NIHNvbHZlcyBXSEVSRSB1c2VyaWQgPSAkMSBBTkQgY2hhbGxlbmdlaWQgPSAkMiBPUkRFUiBCWSBjcmVhdGVkYXQgREVTQycsIFt1c2VyaWQsIGNoYWxsZW5nZWlkXSlcbiAgICAudGhlbihyZXMgPT4gcmVzLnJvd3NbMF0pXG59XG5cbmV4cG9ydCBjb25zdCBuZXdTb2x2ZSA9ICh7IGlkLCB1c2VyaWQsIGNoYWxsZW5nZWlkLCBjcmVhdGVkYXQgfTogU29sdmUpOiBQcm9taXNlPFNvbHZlPiA9PiB7XG4gIHJldHVybiBkYi5xdWVyeTxTb2x2ZT4oJ0lOU0VSVCBJTlRPIHNvbHZlcyAoaWQsIGNoYWxsZW5nZWlkLCB1c2VyaWQsIGNyZWF0ZWRhdCkgVkFMVUVTICgkMSwgJDIsICQzLCAkNCkgUkVUVVJOSU5HIConLCBbaWQsIGNoYWxsZW5nZWlkLCB1c2VyaWQsIGNyZWF0ZWRhdF0pXG4gICAgLnRoZW4ocmVzID0+IHJlcy5yb3dzWzBdKVxufVxuXG5leHBvcnQgY29uc3QgcmVtb3ZlU29sdmVzQnlVc2VySWQgPSBhc3luYyAoeyB1c2VyaWQgfTogUGljazxTb2x2ZSwgJ3VzZXJpZCc+KTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gIGF3YWl0IGRiLnF1ZXJ5KCdERUxFVEUgRlJPTSBzb2x2ZXMgV0hFUkUgdXNlcmlkID0gJDEnLCBbdXNlcmlkXSlcbn1cbiJdfQ==