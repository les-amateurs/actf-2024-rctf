"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.buyItem = exports.addChips = exports.upsertItem = exports.removeItemById = exports.equipPurchase = exports.getEquippedItemByType = exports.getEquippedItems = exports.getItemIdsByUserId = exports.newItem = exports.getItemById = exports.getAllItems = void 0;
const db_1 = __importDefault(require("./db"));
exports.getAllItems = () => {
    return db_1.default
        .query('SELECT * FROM items ORDER BY id ASC')
        .then((res) => res.rows);
};
exports.getItemById = ({ id }) => {
    return db_1.default
        .query('SELECT * FROM items WHERE id = $1', [id])
        .then((res) => res.rows[0]);
};
exports.newItem = ({ name, description, type, price }) => {
    return db_1.default
        .query('INSERT INTO items (name, description, type, price) VALUES ($1, $2, $3, $4) RETURNING *', [name, description, type, price])
        .then((res) => res.rows[0]);
};
exports.getItemIdsByUserId = ({ userid }) => {
    return db_1.default
        .query('SELECT itemid FROM purchases WHERE userid = $1', [userid])
        .then((res) => res.rows.map(e => e.itemid));
};
// TODO only return relavent info
exports.getEquippedItems = ({ userid }) => {
    return db_1.default
        .query('SELECT * FROM items WHERE id IN (SELECT itemid FROM purchases WHERE userid = $1 AND equipped = true)', [userid])
        .then((res) => {
        let map = {};
        for (const item of res.rows) {
            map[item.type] = item;
        }
        return map;
    });
};
exports.getEquippedItemByType = ({ type, userid }) => {
    return db_1.default
        .query('SELECT * FROM items WHERE id = (SELECT itemid FROM purchases WHERE equipped = true AND userid = $1 AND type = $2)', [userid, type])
        .then((res) => res.rows[0]);
};
exports.equipPurchase = async ({ itemid, userid }) => {
    // unequip all other items
    await db_1.default.query('UPDATE purchases SET equipped = false WHERE userid = $1 AND type = (SELECT type FROM items WHERE id = $2) AND itemid != $2', [userid, itemid]);
    return db_1.default
        .query('UPDATE purchases SET equipped = NOT equipped WHERE userid = $1 AND itemid = $2 RETURNING *', [userid, itemid])
        .then((res) => res.rows[0]);
};
exports.removeItemById = ({ id }) => {
    return db_1.default
        .query('DELETE FROM items WHERE id = $1 RETURNING *', [id])
        .then((res) => res.rows[0]);
};
exports.upsertItem = async ({ id, type, price, name, description, resourceUrl, resourceName }) => {
    await db_1.default.query(`INSERT INTO items VALUES($1, $2, $3, $4::item_type, $5, $6, $7)
      ON CONFLICT (id)
      DO UPDATE SET 
        name = $2,
        description = $3,
        type = $4,
        price = $5,
        "resourceUrl" = $6,
        "resourceName" = $7
    `, [id, name, description, type, price, resourceUrl, resourceName]);
};
exports.addChips = (id, chips) => {
    return db_1.default
        .query('UPDATE users SET chips = chips + $1 WHERE id = $2', [
        chips,
        id
    ])
        .then((res) => res.rows[0]);
};
exports.buyItem = async (userid, item) => {
    const purchase = await db_1.default
        .query('INSERT INTO purchases (type, itemid, userid) VALUES ($1, $2, $3) RETURNING *', [item.type, item.id, userid])
        .then((res) => res.rows[0]);
    // is this, timing attack?
    await exports.addChips(userid, -item.price);
    return purchase;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RvcmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zZXJ2ZXIvZGF0YWJhc2Uvc3RvcmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsOENBQXFCO0FBSVIsUUFBQSxXQUFXLEdBQUcsR0FBb0IsRUFBRTtJQUMvQyxPQUFPLFlBQUU7U0FDTixLQUFLLENBQU8scUNBQXFDLENBQUM7U0FDbEQsSUFBSSxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUE7QUFDNUIsQ0FBQyxDQUFBO0FBRVksUUFBQSxXQUFXLEdBQUcsQ0FBQyxFQUMxQixFQUFFLEVBQ2UsRUFBNkIsRUFBRTtJQUNoRCxPQUFPLFlBQUU7U0FDTixLQUFLLENBQU8sbUNBQW1DLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztTQUN0RCxJQUFJLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUMvQixDQUFDLENBQUE7QUFFWSxRQUFBLE9BQU8sR0FBRyxDQUFDLEVBQ3RCLElBQUksRUFDSixXQUFXLEVBQ1gsSUFBSSxFQUNKLEtBQUssRUFDaUQsRUFBaUIsRUFBRTtJQUN6RSxPQUFPLFlBQUU7U0FDTixLQUFLLENBQ0osd0ZBQXdGLEVBQ3hGLENBQUMsSUFBSSxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQ2pDO1NBQ0EsSUFBSSxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDL0IsQ0FBQyxDQUFBO0FBRVksUUFBQSxrQkFBa0IsR0FBRyxDQUFDLEVBQ2pDLE1BQU0sRUFDbUIsRUFBcUIsRUFBRTtJQUNoRCxPQUFPLFlBQUU7U0FDTixLQUFLLENBQ0osZ0RBQWdELEVBQ2hELENBQUMsTUFBTSxDQUFDLENBQ1Q7U0FD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LEVBQ1MsRUFBRTtJQUNyQixNQUFNLFFBQVEsR0FBRyxNQUFNLFlBQUU7U0FDdEIsS0FBSyxDQUNKLDhFQUE4RSxFQUM5RSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxNQUFNLENBQUMsQ0FDN0I7U0FDQSxJQUFJLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtJQUM3QiwwQkFBMEI7SUFDMUIsTUFBTSxnQkFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQTtJQUNuQyxPQUFPLFFBQVEsQ0FBQTtBQUNqQixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZGIgZnJvbSAnLi9kYidcbmltcG9ydCB0eXBlIHsgSXRlbSwgSXRlbVR5cGUsIFB1cmNoYXNlIH0gZnJvbSAnLi4vc3RvcmUvdHlwZXMnXG5pbXBvcnQgeyBVc2VyIH0gZnJvbSAnLi91c2VycydcblxuZXhwb3J0IGNvbnN0IGdldEFsbEl0ZW1zID0gKCk6IFByb21pc2U8SXRlbVtdPiA9PiB7XG4gIHJldHVybiBkYlxuICAgIC5xdWVyeTxJdGVtPignU0VMRUNUICogRlJPTSBpdGVtcyBPUkRFUiBCWSBpZCBBU0MnKVxuICAgIC50aGVuKChyZXMpID0+IHJlcy5yb3dzKVxufVxuXG5leHBvcnQgY29uc3QgZ2V0SXRlbUJ5SWQgPSAoe1xuICBpZFxufTogUGljazxJdGVtLCAnaWQnPik6IFByb21pc2U8SXRlbSB8IHVuZGVmaW5lZD4gPT4ge1xuICByZXR1cm4gZGJcbiAgICAucXVlcnk8SXRlbT4oJ1NFTEVDVCAqIEZST00gaXRlbXMgV0hFUkUgaWQgPSAkMScsIFtpZF0pXG4gICAgLnRoZW4oKHJlcykgPT4gcmVzLnJvd3NbMF0pXG59XG5cbmV4cG9ydCBjb25zdCBuZXdJdGVtID0gKHtcbiAgbmFtZSxcbiAgZGVzY3JpcHRpb24sXG4gIHR5cGUsXG4gIHByaWNlXG59OiBQaWNrPEl0ZW0sICduYW1lJyB8ICdkZXNjcmlwdGlvbicgfCAndHlwZScgfCAncHJpY2UnPik6IFByb21pc2U8SXRlbT4gPT4ge1xuICByZXR1cm4gZGJcbiAgICAucXVlcnk8SXRlbT4oXG4gICAgICAnSU5TRVJUIElOVE8gaXRlbXMgKG5hbWUsIGRlc2NyaXB0aW9uLCB0eXBlLCBwcmljZSkgVkFMVUVTICgkMSwgJDIsICQzLCAkNCkgUkVUVVJOSU5HIConLFxuICAgICAgW25hbWUsIGRlc2NyaXB0aW9uLCB0eXBlLCBwcmljZV1cbiAgICApXG4gICAgLnRoZW4oKHJlcykgPT4gcmVzLnJvd3NbMF0pXG59XG5cbmV4cG9ydCBjb25zdCBnZXRJdGVtSWRzQnlVc2VySWQgPSAoe1xuICB1c2VyaWRcbn06IFBpY2s8UHVyY2hhc2UsICd1c2VyaWQnPik6IFByb21pc2U8c3RyaW5nW10+ID0+IHtcbiAgcmV0dXJuIGRiXG4gICAgLnF1ZXJ5PHsgaXRlbWlkOiBzdHJpbmcgfT4oXG4gICAgICAnU0VMRUNUIGl0ZW1pZCBGUk9NIHB1cmNoYXNlcyBXSEVSRSB1c2VyaWQgPSAkMScsXG4gICAgICBbdXNlcmlkXVxuICAgIClcbiAgICAudGhlbigocmVzKSA9PiByZXMucm93cy5tYXAoZSA9PiBlLml0ZW1pZCkpXG59XG5cbi8vIFRPRE8gb25seSByZXR1cm4gcmVsYXZlbnQgaW5mb1xuZXhwb3J0IGNvbnN0IGdldEVxdWlwcGVkSXRlbXMgPSAoe1xuICB1c2VyaWRcbn06IFBpY2s8UHVyY2hhc2UsICd1c2VyaWQnPik6IFByb21pc2U8eyBba2V5IGluIEl0ZW1UeXBlXT86IEl0ZW0gfT4gPT4ge1xuICByZXR1cm4gZGJcbiAgICAucXVlcnk8SXRlbT4oXG4gICAgICAnU0VMRUNUICogRlJPTSBpdGVtcyBXSEVSRSBpZCBJTiAoU0VMRUNUIGl0ZW1pZCBGUk9NIHB1cmNoYXNlcyBXSEVSRSB1c2VyaWQgPSAkMSBBTkQgZXF1aXBwZWQgPSB0cnVlKScsXG4gICAgICBbdXNlcmlkXVxuICAgIClcbiAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICBsZXQgbWFwOiB7IFtrZXkgaW4gSXRlbVR5cGVdPzogSXRlbSB9ID0ge31cbiAgICAgIGZvciAoY29uc3QgaXRlbSBvZiByZXMucm93cykge1xuICAgICAgICBtYXBbaXRlbS50eXBlXSA9IGl0ZW1cbiAgICAgIH1cbiAgICAgIHJldHVybiBtYXBcbiAgICB9KVxufVxuXG5leHBvcnQgY29uc3QgZ2V0RXF1aXBwZWRJdGVtQnlUeXBlID0gKHtcbiAgdHlwZSxcbiAgdXNlcmlkXG59OiBQaWNrPFB1cmNoYXNlLCAndXNlcmlkJyB8ICd0eXBlJz4pOiBQcm9taXNlPEl0ZW0+ID0+IHtcbiAgcmV0dXJuIGRiXG4gICAgLnF1ZXJ5PEl0ZW0+KFxuICAgICAgJ1NFTEVDVCAqIEZST00gaXRlbXMgV0hFUkUgaWQgPSAoU0VMRUNUIGl0ZW1pZCBGUk9NIHB1cmNoYXNlcyBXSEVSRSBlcXVpcHBlZCA9IHRydWUgQU5EIHVzZXJpZCA9ICQxIEFORCB0eXBlID0gJDIpJyxcbiAgICAgIFt1c2VyaWQsIHR5cGVdXG4gICAgKVxuICAgIC50aGVuKChyZXMpID0+IHJlcy5yb3dzWzBdKVxufVxuXG5leHBvcnQgY29uc3QgZXF1aXBQdXJjaGFzZSA9IGFzeW5jICh7XG4gIGl0ZW1pZCxcbiAgdXNlcmlkXG59OiBQaWNrPFB1cmNoYXNlLCAndHlwZScgfCAndXNlcmlkJyB8ICdpdGVtaWQnPik6IFByb21pc2U8UHVyY2hhc2U+ID0+IHtcbiAgLy8gdW5lcXVpcCBhbGwgb3RoZXIgaXRlbXNcbiAgYXdhaXQgZGIucXVlcnkoXG4gICAgJ1VQREFURSBwdXJjaGFzZXMgU0VUIGVxdWlwcGVkID0gZmFsc2UgV0hFUkUgdXNlcmlkID0gJDEgQU5EIHR5cGUgPSAoU0VMRUNUIHR5cGUgRlJPTSBpdGVtcyBXSEVSRSBpZCA9ICQyKSBBTkQgaXRlbWlkICE9ICQyJyxcbiAgICBbdXNlcmlkLCBpdGVtaWRdXG4gIClcblxuICByZXR1cm4gZGJcbiAgICAucXVlcnk8UHVyY2hhc2U+KFxuICAgICAgJ1VQREFURSBwdXJjaGFzZXMgU0VUIGVxdWlwcGVkID0gTk9UIGVxdWlwcGVkIFdIRVJFIHVzZXJpZCA9ICQxIEFORCBpdGVtaWQgPSAkMiBSRVRVUk5JTkcgKicsXG4gICAgICBbdXNlcmlkLCBpdGVtaWRdXG4gICAgKVxuICAgIC50aGVuKChyZXMpID0+IHJlcy5yb3dzWzBdKVxufVxuXG5leHBvcnQgY29uc3QgcmVtb3ZlSXRlbUJ5SWQgPSAoe1xuICBpZFxufTogUGljazxJdGVtLCAnaWQnPik6IFByb21pc2U8SXRlbSB8IHVuZGVmaW5lZD4gPT4ge1xuICByZXR1cm4gZGJcbiAgICAucXVlcnk8SXRlbT4oJ0RFTEVURSBGUk9NIGl0ZW1zIFdIRVJFIGlkID0gJDEgUkVUVVJOSU5HIConLCBbaWRdKVxuICAgIC50aGVuKChyZXMpID0+IHJlcy5yb3dzWzBdKVxufVxuXG5leHBvcnQgY29uc3QgdXBzZXJ0SXRlbSA9IGFzeW5jICh7XG4gIGlkLFxuICB0eXBlLFxuICBwcmljZSxcbiAgbmFtZSxcbiAgZGVzY3JpcHRpb24sXG4gIHJlc291cmNlVXJsLFxuICByZXNvdXJjZU5hbWVcbn06IEl0ZW0pOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgYXdhaXQgZGIucXVlcnkoXG4gICAgYElOU0VSVCBJTlRPIGl0ZW1zIFZBTFVFUygkMSwgJDIsICQzLCAkNDo6aXRlbV90eXBlLCAkNSwgJDYsICQ3KVxuICAgICAgT04gQ09ORkxJQ1QgKGlkKVxuICAgICAgRE8gVVBEQVRFIFNFVCBcbiAgICAgICAgbmFtZSA9ICQyLFxuICAgICAgICBkZXNjcmlwdGlvbiA9ICQzLFxuICAgICAgICB0eXBlID0gJDQsXG4gICAgICAgIHByaWNlID0gJDUsXG4gICAgICAgIFwicmVzb3VyY2VVcmxcIiA9ICQ2LFxuICAgICAgICBcInJlc291cmNlTmFtZVwiID0gJDdcbiAgICBgLFxuICAgIFtpZCwgbmFtZSwgZGVzY3JpcHRpb24sIHR5cGUsIHByaWNlLCByZXNvdXJjZVVybCwgcmVzb3VyY2VOYW1lXVxuICApXG59XG5cbmV4cG9ydCBjb25zdCBhZGRDaGlwcyA9IChcbiAgaWQ6IHN0cmluZyxcbiAgY2hpcHM6IG51bWJlclxuKTogUHJvbWlzZTxVc2VyIHwgdW5kZWZpbmVkPiA9PiB7XG4gIHJldHVybiBkYlxuICAgIC5xdWVyeTxVc2VyPignVVBEQVRFIHVzZXJzIFNFVCBjaGlwcyA9IGNoaXBzICsgJDEgV0hFUkUgaWQgPSAkMicsIFtcbiAgICAgIGNoaXBzLFxuICAgICAgaWRcbiAgICBdKVxuICAgIC50aGVuKChyZXMpID0+IHJlcy5yb3dzWzBdKVxufVxuXG5leHBvcnQgY29uc3QgYnV5SXRlbSA9IGFzeW5jIChcbiAgdXNlcmlkOiBzdHJpbmcsXG4gIGl0ZW06IEl0ZW1cbik6IFByb21pc2U8UHVyY2hhc2U+ID0+IHtcbiAgY29uc3QgcHVyY2hhc2UgPSBhd2FpdCBkYlxuICAgIC5xdWVyeTxQdXJjaGFzZT4oXG4gICAgICAnSU5TRVJUIElOVE8gcHVyY2hhc2VzICh0eXBlLCBpdGVtaWQsIHVzZXJpZCkgVkFMVUVTICgkMSwgJDIsICQzKSBSRVRVUk5JTkcgKicsXG4gICAgICBbaXRlbS50eXBlLCBpdGVtLmlkLCB1c2VyaWRdXG4gICAgKVxuICAgIC50aGVuKChyZXMpID0+IHJlcy5yb3dzWzBdKVxuICAvLyBpcyB0aGlzLCB0aW1pbmcgYXR0YWNrP1xuICBhd2FpdCBhZGRDaGlwcyh1c2VyaWQsIC1pdGVtLnByaWNlKVxuICByZXR1cm4gcHVyY2hhc2Vcbn1cbiJdfQ==