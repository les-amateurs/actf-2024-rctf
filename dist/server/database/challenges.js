"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.upsertChallenge = exports.removeChallengeById = exports.createChallenge = exports.getChallengeById = exports.getAllChallenges = void 0;
const db_1 = __importDefault(require("./db"));
exports.getAllChallenges = () => {
    return db_1.default.query('SELECT * FROM challenges')
        .then(res => res.rows);
};
exports.getChallengeById = ({ id }) => {
    return db_1.default.query('SELECT * FROM challenges WHERE id = $1', [id])
        .then(res => res.rows[0]);
};
exports.createChallenge = ({ id, data }) => {
    return db_1.default.query('INSERT INTO challenges ($1, $2) RETURNING *', [id, data])
        .then(res => res.rows[0]);
};
exports.removeChallengeById = ({ id }) => {
    return db_1.default.query('DELETE FROM challenges WHERE id = $1 RETURNING *', [id])
        .then(res => res.rows[0]);
};
exports.upsertChallenge = async ({ id, data }) => {
    await db_1.default.query(`
    INSERT INTO challenges VALUES($1, $2)
      ON CONFLICT (id)
      DO UPDATE SET data = $2
    `, [id, data]);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhbGxlbmdlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NlcnZlci9kYXRhYmFzZS9jaGFsbGVuZ2VzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDhDQUFxQjtBQVFSLFFBQUEsZ0JBQWdCLEdBQUcsR0FBaUMsRUFBRTtJQUNqRSxPQUFPLFlBQUUsQ0FBQyxLQUFLLENBQW9CLDBCQUEwQixDQUFDO1NBQzNELElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQTtBQUMxQixDQUFDLENBQUE7QUFFWSxRQUFBLGdCQUFnQixHQUFHLENBQUMsRUFBRSxFQUFFLEVBQWlDLEVBQTBDLEVBQUU7SUFDaEgsT0FBTyxZQUFFLENBQUMsS0FBSyxDQUFvQix3Q0FBd0MsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQy9FLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUM3QixDQUFDLENBQUE7QUFFWSxRQUFBLGVBQWUsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBcUIsRUFBOEIsRUFBRTtJQUM3RixPQUFPLFlBQUUsQ0FBQyxLQUFLLENBQW9CLDZDQUE2QyxFQUM5RSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsQ0FDWDtTQUNFLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUM3QixDQUFDLENBQUE7QUFFWSxRQUFBLG1CQUFtQixHQUFHLENBQUMsRUFBRSxFQUFFLEVBQWlDLEVBQTBDLEVBQUU7SUFDbkgsT0FBTyxZQUFFLENBQUMsS0FBSyxDQUFvQixrREFBa0QsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQ3pGLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUM3QixDQUFDLENBQUE7QUFFWSxRQUFBLGVBQWUsR0FBRyxLQUFLLEVBQUUsRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFxQixFQUFpQixFQUFFO0lBQ3RGLE1BQU0sWUFBRSxDQUFDLEtBQUssQ0FBQzs7OztLQUlaLEVBQ0gsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLENBQ1QsQ0FBQTtBQUNILENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBkYiBmcm9tICcuL2RiJ1xuaW1wb3J0IHsgQ2hhbGxlbmdlIH0gZnJvbSAnLi4vY2hhbGxlbmdlcy90eXBlcydcblxuZXhwb3J0IGludGVyZmFjZSBEYXRhYmFzZUNoYWxsZW5nZSB7XG4gIGlkOiBzdHJpbmc7XG4gIGRhdGE6IE9taXQ8Q2hhbGxlbmdlLCAnaWQnPjtcbn1cblxuZXhwb3J0IGNvbnN0IGdldEFsbENoYWxsZW5nZXMgPSAoKTogUHJvbWlzZTxEYXRhYmFzZUNoYWxsZW5nZVtdPiA9PiB7XG4gIHJldHVybiBkYi5xdWVyeTxEYXRhYmFzZUNoYWxsZW5nZT4oJ1NFTEVDVCAqIEZST00gY2hhbGxlbmdlcycpXG4gICAgLnRoZW4ocmVzID0+IHJlcy5yb3dzKVxufVxuXG5leHBvcnQgY29uc3QgZ2V0Q2hhbGxlbmdlQnlJZCA9ICh7IGlkIH06IFBpY2s8RGF0YWJhc2VDaGFsbGVuZ2UsICdpZCc+KTogUHJvbWlzZTxEYXRhYmFzZUNoYWxsZW5nZSB8IHVuZGVmaW5lZD4gPT4ge1xuICByZXR1cm4gZGIucXVlcnk8RGF0YWJhc2VDaGFsbGVuZ2U+KCdTRUxFQ1QgKiBGUk9NIGNoYWxsZW5nZXMgV0hFUkUgaWQgPSAkMScsIFtpZF0pXG4gICAgLnRoZW4ocmVzID0+IHJlcy5yb3dzWzBdKVxufVxuXG5leHBvcnQgY29uc3QgY3JlYXRlQ2hhbGxlbmdlID0gKHsgaWQsIGRhdGEgfTogRGF0YWJhc2VDaGFsbGVuZ2UpOiBQcm9taXNlPERhdGFiYXNlQ2hhbGxlbmdlPiA9PiB7XG4gIHJldHVybiBkYi5xdWVyeTxEYXRhYmFzZUNoYWxsZW5nZT4oJ0lOU0VSVCBJTlRPIGNoYWxsZW5nZXMgKCQxLCAkMikgUkVUVVJOSU5HIConLFxuICAgIFtpZCwgZGF0YV1cbiAgKVxuICAgIC50aGVuKHJlcyA9PiByZXMucm93c1swXSlcbn1cblxuZXhwb3J0IGNvbnN0IHJlbW92ZUNoYWxsZW5nZUJ5SWQgPSAoeyBpZCB9OiBQaWNrPERhdGFiYXNlQ2hhbGxlbmdlLCAnaWQnPik6IFByb21pc2U8RGF0YWJhc2VDaGFsbGVuZ2UgfCB1bmRlZmluZWQ+ID0+IHtcbiAgcmV0dXJuIGRiLnF1ZXJ5PERhdGFiYXNlQ2hhbGxlbmdlPignREVMRVRFIEZST00gY2hhbGxlbmdlcyBXSEVSRSBpZCA9ICQxIFJFVFVSTklORyAqJywgW2lkXSlcbiAgICAudGhlbihyZXMgPT4gcmVzLnJvd3NbMF0pXG59XG5cbmV4cG9ydCBjb25zdCB1cHNlcnRDaGFsbGVuZ2UgPSBhc3luYyAoeyBpZCwgZGF0YSB9OiBEYXRhYmFzZUNoYWxsZW5nZSk6IFByb21pc2U8dm9pZD4gPT4ge1xuICBhd2FpdCBkYi5xdWVyeShgXG4gICAgSU5TRVJUIElOVE8gY2hhbGxlbmdlcyBWQUxVRVMoJDEsICQyKVxuICAgICAgT04gQ09ORkxJQ1QgKGlkKVxuICAgICAgRE8gVVBEQVRFIFNFVCBkYXRhID0gJDJcbiAgICBgLFxuICBbaWQsIGRhdGFdXG4gIClcbn1cbiJdfQ==